<!DOCTYPE html>
<meta charset="utf-8" />

<head>
  <title>basemap -- pan & zoom</title>
  <script src="./jquery.js"></script>

  <script src="http://d3js.org/d3.v3.min.js"></script>
  <style type="text/css">
    .overlay {
      fill: "black";
      pointer-events: all;
    }
  </style>
</head>

<body>
  <script>
    var imgHeight = 1024,
      imgWidth = 1024, // Image dimensions (don't change these)
      width = 1024,
      height = 1024, // Dimensions of cropped region
      translate0 = [0, 0],
      scale0 = 1; // Initial offset & scale

    svg = d3
      .select("body")
      .append("svg")
      .attr("width", width + "px")
      .attr("height", height + "px");

    svg
      .append("rect")
      .attr("class", "overlay")
      .attr("width", width + "px")
      .attr("height", height + "px");

    image = svg.append("g").attr("id", "image");

    svg = svg
      .append("g")
      .attr("transform", "translate(" + translate0 + ")scale(" + scale0 + ")")
      .call(
        d3.behavior
          .zoom()
          .scaleExtent([1, 8])
          .on("zoom", zoom)
      )
      .append("g");

    svg
      .append("image")
      .attr("width", imgWidth + "px")
      .attr("height", imgHeight + "px");

    function zoom() {
      svg.attr(
        "transform",
        "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")"
      );

      $.get("http://localhost:8090/get_svg").done(function(d) {
        /* console.log(d.svg);
        console.log(svg);
         */ 
        image.html(
          d.svg
        );
      });

      console.log(
        "translate: " + d3.event.translate + ", scale: " + d3.event.scale
      );
    }
  </script>
</body>
