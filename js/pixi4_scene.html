<!DOCTYPE html>
<html>
  <head>
    <script src="pixi.min.js"></script>
    <script src="jquery.min.js"></script>
    <script src="jquery.mousewheel.min.js"></script>
  </head>

  <body>
    <canvas id="canvas"></canvas>
    Old Scale:<span id="oldScale"></span><br />
    New Scale:<span id="scale"></span><br />
    <br />
    Correction:<span id="c"></span><br />
    <br />
    Old XY:<span id="oldXY"></span><br />
    New XY:<span id="xy"></span><br />

    <script>
      // Code goes here

      let app = new PIXI.Application({
        width: 1024, // default: 800
        height: 1024, // default: 600
        antialias: true, // default: false
        transparent: false, // default: false
        resolution: 1, // default: 1
        forceCanvas: false
      });
      document.body.appendChild(app.view);
      let circle = new PIXI.Graphics();
      circle.beginFill(0x9966ff);
      circle.drawCircle(0, 0, 32);
      circle.endFill();
      circle.x = 64;
      circle.y = 130;
      app.stage.addChild(circle);
      /* function zoom(s, x, y) {
        s = s > 0 ? 2 : 0.5;
        document.getElementById("oldScale").innerHTML = stage.scale.x.toFixed(
          4
        );
        document.getElementById("oldXY").innerHTML =
          "(" + stage.x.toFixed(4) + "," + stage.y.toFixed(4) + ")";
        var worldPos = {
          x: (x - stage.x) / stage.scale.x,
          y: (y - stage.y) / stage.scale.y
        };
        var newScale = { x: stage.scale.x * s, y: stage.scale.y * s };

        var newScreenPos = {
          x: worldPos.x * newScale.x + stage.x,
          y: worldPos.y * newScale.y + stage.y
        };

        stage.x -= newScreenPos.x - x;
        stage.y -= newScreenPos.y - y;
        stage.scale.x = newScale.x;
        stage.scale.y = newScale.y;
        document.getElementById("scale").innerHTML = newScale.x.toFixed(4);
        document.getElementById("xy").innerHTML =
          "(" + stage.x.toFixed(4) + "," + stage.y.toFixed(4) + ")";

        document.getElementById("c").innerHTML = c;
      }
 */
      var lastPos = null;

      $("body")
        .mousewheel(function(e) {
          /* zoom(e.deltaY, e.offsetX, e.offsetY); */
          app.renderer.refresh = true;
          $.get("http://localhost:8090/random_scene/").done(function(d) {
            d.circles.forEach(function myFunction(v, index, array) {
              let g = new PIXI.Graphics();
              app.stage.addChild(g);

              g.beginFill(0xffff00);
              g.drawCircle(v[0], v[1], v[2]);
              g.endFill();
            });
            console.log("done painting");
          });
        })
        .mousedown(function(e) {
          lastPos = { x: e.offsetX, y: e.offsetY };
        })
        .mouseup(function(event) {
          lastPos = null;
        })
        .mousemove(function(e) {
          if (lastPos) {
            stage.x += e.offsetX - lastPos.x;
            stage.y += e.offsetY - lastPos.y;
            lastPos = { x: e.offsetX, y: e.offsetY };
          }
        });
    </script>
  </body>
</html>
